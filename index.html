<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>静态网址音乐播放器</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f3f6fa;
            margin: 0;
            padding: 0;
        }
        .container {
            max-width: 480px;
            margin: 40px auto;
            background: #fff;
            border-radius: 14px;
            box-shadow: 0 4px 24px rgba(0,0,0,0.08);
            padding: 2rem 1.5rem 1.5rem 1.5rem;
        }
        h1 {
            text-align: center;
            font-size: 1.5rem;
            color: #232f40;
        }
        .song-list {
            margin: 1rem 0;
            padding: 0;
            list-style: none;
            max-height: 220px;
            overflow-y: auto;
            background: #f7faff;
            border-radius: 8px;
            border: 1px solid #e4eaf1;
        }
        .song-item {
            display: flex;
            align-items: center;
            padding: 0.7rem 1rem;
            cursor: pointer;
            border-bottom: 1px solid #e4eaf1;
            transition: background 0.18s;
        }
        .song-item:last-child { border-bottom: none; }
        .song-item.active {
            background: #e7f0fa;
            color: #2576d2;
            font-weight: bold;
        }
        .song-title {
            flex: 1;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .add-section {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }
        .add-section input {
            flex: 1;
            padding: 0.6rem;
            border: 1.5px solid #cdd6e2;
            border-radius: 6px;
            font-size: 1rem;
        }
        .add-section button {
            background: #2576d2;
            color: #fff;
            border: none;
            border-radius: 6px;
            padding: 0.6rem 1.1rem;
            cursor: pointer;
            font-size: 1rem;
            transition: background 0.2s;
        }
        .add-section button:hover { background: #195ca6; }
        .controls {
            display: flex;
            justify-content: center;
            gap: 1.2rem;
            margin: 1.2rem 0 0.2rem 0;
        }
        .controls button {
            background: #f6f8fa;
            border: none;
            border-radius: 50%;
            width: 44px;
            height: 44px;
            font-size: 1.1rem;
            color: #2576d2;
            cursor: pointer;
            transition: background 0.18s, color 0.18s;
        }
        .controls button.active,
        .controls button:hover {
            background: #2576d2;
            color: #fff;
        }
        .status {
            text-align: center;
            font-size: 0.98rem;
            color: #888;
            min-height: 1.3em;
        }
        .footer {
            margin-top: 1.2rem;
            color: #aab5c7;
            font-size: 0.92rem;
            text-align: center;
        }
        @media (max-width: 600px) {
            .container { padding: 1rem 0.5rem 1rem 0.5rem;}
        }
    </style>
</head>
<body>
<div class="container">
    <h1>静态网址音乐播放器</h1>
    <div class="add-section">
        <input type="text" id="musicUrl" placeholder="输入音乐地址或相对路径">
        <button id="addBtn">添加</button>
    </div>
    <ul id="songList" class="song-list">
        <li class="song-item" style="color:#aaa;text-align:center;">暂无歌曲，请添加</li>
    </ul>
    <div class="controls">
        <button id="prevBtn" title="上一首">&#9664;</button>
        <button id="playBtn" title="播放">&#9654;</button>
        <button id="pauseBtn" title="暂停">&#10073;&#10073;</button>
        <button id="nextBtn" title="下一首">&#9654;&#9654;</button>
        <button id="randomBtn" title="随机播放">&#128256;</button>
    </div>
    <div id="status" class="status"></div>
    <audio id="audioPlayer"></audio>
    <div class="footer">
        支持静态资源、绝对/相对路径。点击歌曲可直接播放。<br>
        如遇无法播放，请检查资源路径或跨域问题。
    </div>
</div>
<script>
const musicUrlInput = document.getElementById('musicUrl');
const addBtn = document.getElementById('addBtn');
const songList = document.getElementById('songList');
const playBtn = document.getElementById('playBtn');
const pauseBtn = document.getElementById('pauseBtn');
const prevBtn = document.getElementById('prevBtn');
const nextBtn = document.getElementById('nextBtn');
const randomBtn = document.getElementById('randomBtn');
const status = document.getElementById('status');
const audioPlayer = document.getElementById('audioPlayer');

let playlist = [];
let currentIndex = -1;
let isRandom = false;
let playedIndices = [];

function getSongName(url) {
    return decodeURIComponent(url.split('/').pop().split('?')[0].replace(/\.mp3$/i, ''));
}
function updateSongList() {
    if (playlist.length === 0) {
        songList.innerHTML = '<li class="song-item" style="color:#aaa;text-align:center;">暂无歌曲，请添加</li>';
        return;
    }
    songList.innerHTML = '';
    playlist.forEach((url, idx) => {
        const li = document.createElement('li');
        li.className = "song-item" + (idx === currentIndex ? " active" : "");
        li.title = url;
        li.innerHTML = `<span class="song-title">${getSongName(url)}</span>`;
        li.onclick = () => playAt(idx);
        songList.appendChild(li);
    });
}
function normalizeUrl(url) {
    url = url.trim();
    if (!url) return '';
    if (
        url.startsWith('http://') ||
        url.startsWith('https://') ||
        url.startsWith('//') ||
        url.startsWith('/')
    ) return url;
    // 适配静态站点的相对路径
    return url;
}
function addSong() {
    let url = musicUrlInput.value.trim();
    if (!url) {
        status.textContent = "请输入音乐地址";
        return;
    }
    url = normalizeUrl(url);
    playlist.push(url);
    updateSongList();
    status.textContent = "添加成功: " + getSongName(url);
    if (playlist.length === 1) {
        playAt(0);
    }
    musicUrlInput.value = '';
}
function playAt(idx) {
    if (playlist.length === 0) return;
    if (idx < 0 || idx >= playlist.length) idx = 0;
    currentIndex = idx;
    audioPlayer.src = playlist[currentIndex];
    audioPlayer.play().catch(e=>{
        status.textContent = "播放失败: " + (e.message || e);
    });
    updateSongList();
    updateControls();
    status.textContent = "正在播放: " + getSongName(playlist[currentIndex]);
}
function playCurrent() {
    if (currentIndex < 0 && playlist.length > 0) playAt(0);
    else if (currentIndex >= 0) {
        audioPlayer.play().catch(e=>{
            status.textContent = "播放失败: " + (e.message || e);
        });
        status.textContent = "正在播放: " + getSongName(playlist[currentIndex]);
    }
}
function pauseCurrent() {
    audioPlayer.pause();
    status.textContent = "已暂停: " + getSongName(playlist[currentIndex]);
}
function nextSong() {
    if (playlist.length === 0) return;
    let idx;
    if (isRandom && playlist.length > 1) {
        if (playedIndices.length >= playlist.length - 1) playedIndices = [];
        do {
            idx = Math.floor(Math.random() * playlist.length);
        } while (idx === currentIndex || playedIndices.includes(idx));
        playedIndices.push(currentIndex);
    } else {
        idx = (currentIndex + 1) % playlist.length;
    }
    playAt(idx);
}
function prevSong() {
    if (playlist.length === 0) return;
    let idx = currentIndex - 1;
    if (idx < 0) idx = playlist.length - 1;
    playAt(idx);
}
function updateControls() {
    Array.from(songList.children).forEach((child, idx) => {
        child.classList.toggle('active', idx === currentIndex);
    });
}
addBtn.onclick = addSong;
musicUrlInput.addEventListener("keydown", e => {
    if (e.key === "Enter") addSong();
});
playBtn.onclick = playCurrent;
pauseBtn.onclick = pauseCurrent;
nextBtn.onclick = nextSong;
prevBtn.onclick = prevSong;
randomBtn.onclick = () => {
    isRandom = !isRandom;
    randomBtn.classList.toggle("active", isRandom);
    status.textContent = isRandom ? "已开启随机播放" : "已关闭随机播放";
    playedIndices = [];
    if (currentIndex !== -1) playedIndices.push(currentIndex);
};
// 自动播放下一首
audioPlayer.onended = nextSong;
// 状态初始化
updateSongList();
status.textContent = "请添加音乐到播放列表";
</script>
</body>
</html>
